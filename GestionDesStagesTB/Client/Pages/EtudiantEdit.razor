@page "/etudiantedit"
@using GestionDesStagesTB.Shared.Models;
@attribute [Authorize(Policy = @GestionDesStagesTB.Shared.Policies.Policies.EstEtudiant)]
@using Microsoft.AspNetCore.Authorization
<section>
    <AuthorizeView>
        <Authorized>
            <h3 style="background-color: black; color: white; padding: 5px 5px 5px 5px;" class="page-title">Détail des informations de votre profil | @context.User.Identity.Name</h3>
        </Authorized>
    </AuthorizeView>
    <p class="text-muted" style="font-style:italic">Prenez note que votre courriel et votre mot de passe peuvent être modifiés en cliquant en haut à droite.</p>
    <EditForm Model="@Etudiant" OnValidSubmit="@HandleValidSubmit" OnInvalidSubmit="@HandleInvalidSubmit">
        <DataAnnotationsValidator />
        <ValidationSummary></ValidationSummary>

        <div class="form-group row">
            <label asp-for="Prenom" class="col-sm-3">Votre prénom :</label>
            <InputText id="Prenom" class="form-control col-sm-8" @bind-Value="@Etudiant.Prenom" placeholder="Entrer votre prénom"></InputText>
            <ValidationMessage class="offset-sm-3 col-sm-8" For="@(() => Etudiant.Prenom)" />
        </div>

        <div class="form-group row">
            <label asp-for="Nom" class="col-sm-3">Votre nom :</label>
            <InputText id="Nom" class="form-control col-sm-8" @bind-Value="@Etudiant.Nom" placeholder="Entrer votre nom"></InputText>
            <ValidationMessage class="offset-sm-3 col-sm-8" For="@(() => Etudiant.Nom)" />
        </div>

        <div class="form-group row">
            <label asp-for="TelephoneCellulaire" class="col-sm-3">Votre téléphone cellulaire :</label>
            <InputText id="TelephoneCellulaire" class="form-control col-sm-8" @bind-Value="@Etudiant.TelephoneCellulaire" placeholder="Entrer votre numéro de téléphone cellulaire"></InputText>
            <label class="offset-sm-3 col-sm-8 text-muted">Merci de saisir avec le format suivant : 9999999999)</label>
            <ValidationMessage class="offset-sm-3 col-sm-8" For="@(() => Etudiant.TelephoneCellulaire)" />
        </div>

        <button type="submit" class="btn btn-primary edit-btn">Enregistrer les informations</button>
        <a class="btn btn-outline-primary" @onclick="@NavigateToOverview">Annuler</a>
    </EditForm>
    <br />
    @if (!string.IsNullOrEmpty(Etudiant.Id))
    {
        <h3 style="background-color: black; color: white; padding: 5px 5px 5px 5px;" class="page-title">Pièces jointes</h3>
        <p>
            <label>
                <p class="text-muted" style="font-style:italic">Prenez note que si plus que @maxAllowedFiles fichiers sont sélectionnés simultanément la demande est annulée</p>
                <InputFile OnChange="@OnInputFileChange" multiple />
            </label>
        </p>
        <table class="table">
            <thead>
                <tr>
                    <th>Fichier</th>
                    <th>Date versée</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                @foreach (var piecejointe in PiecesJointes)
                {
                    <tr>
                        <td>@piecejointe.FileName</td>
                        <td>@piecejointe.DateVersee.ToString("yyyy-MM-dd")</td>
                        <td>
                            <Button class="btn btn-primary" @onclick='@(async () => await OnClickDownloadButton(piecejointe.StoredFileName))'>
                                Consulter
                            </Button>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    }
    else
    {
        <p class="text-muted" style="font-style:italic">
            Pour charger des pièces jointes vous devez d'abord sauvegarder votre profil et revenir dans cette page.
        </p>
    }
</section>
